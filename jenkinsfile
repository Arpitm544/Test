pipeline {  
    agent any  
    tools {
        nodejs 'NodeJS' 
    }
    stages {  
        stage("Dependencies") {  
            steps {  
                sh 'npm install'  
            }  
 when {  
                expression {  
                    return fileExists('package.json')  
                }  
            }
        }  
        stage("Run Server") {  
            steps {  
                sh 'node server.js &'  
            }  
        }  
        stage("Test") {  
            steps {  
                sh 'npm test || echo "No tests defined"'  
            }  
        }  
        stage("Build") {  
            steps {  
                echo 'npm run build'  
            }  
        }
    }  
 post{
     success {
        echo 'Build completed successfully!'
     }
     failure {
        echo 'Build failed!'
     }   
    }
}
